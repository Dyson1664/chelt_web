{% extends 'base.html' %}

{% load static %}

{% block title %}
races
{% endblock %}

{% block races %}

<script>
function fetchRaceDetails(location) {
    fetch(`/get-race-details?location=${location}`)
        .then(response => response.json())
        .then(data => {
            // Update the #race-details div with the fetched data
            document.getElementById('race-details').innerHTML = formatRaceDetails(data);
        });
}

function formatRaceDetails(data) {
    // Format the race details into HTML
    // This is where you define how you want to display the race details
    return '<div>' + JSON.stringify(data) + '</div>'; // Example formatting
}
</script>

<!--<script>-->
<!--function toggleRaceDetails(element, raceNameSlug) {-->
<!--    var placeholder = document.getElementById('dropdown-placeholder-' + raceNameSlug);-->

<!--    if (placeholder.style.display === 'block') {-->
<!--        placeholder.style.display = 'none';-->
<!--    } else {-->
<!--        placeholder.style.display = 'block';-->
<!--        placeholder.innerHTML = '<div class="race-details">Details for ' + raceNameSlug + '</div>';-->
<!--        // Populate with actual race details-->
<!--    }-->
<!--}-->

<!--</script>-->

<script>
document.addEventListener("DOMContentLoaded", function() {
    const raceLinks = document.querySelectorAll('.racecourse a[data-toggle="collapse"]');

    raceLinks.forEach(function(link) {
        link.addEventListener('click', function(event) {
            event.preventDefault();
            const raceDetailDiv = document.getElementById(this.getAttribute('href').substring(1));
            if (raceDetailDiv.classList.contains('show')) {
                raceDetailDiv.classList.remove('show');
            } else {
                raceDetailDiv.classList.add('show');
            }
        });
    });
});
</script>
<div class="container-horse">
    {% for course, races in races_by_course.items %}
        <div class="racecourse">
            <div class="row align-items-center justify-content-center">
                <!-- Course Name Column -->
                <div class="col-md-3 text-center">
                    <h3>{{ course }}</h3>
                </div>

                <!-- Race Times Column -->
                <div class="col-md-6 text-start">
                    {% for race in races %}
                        <a href="#{{ race.race_name_slug }}" data-toggle="collapse" aria-expanded="false" class="race-time-link">
                            {{ race.start_time }}
                        </a>
                    {% endfor %}
                </div>
            </div>

            <!-- Race Details -->
            {% for race in races %}
                <div class="collapse" id="{{ race.race_name_slug }}">
                    <div class="card card-body text-center">
                        <!-- Race details as before -->
                        <p class="fw-semibold fs-5">Race Name: {{ race.race_name }}</p>
                        <div class="race-box">
                            <ul>
                                <li>Starters: {{ race.field_size }} Distance: {{ race.race_distance }} Age: {{ race.age_band }}</li>
                                <li>Prize: {{ race.prize }} Going: {{ race.going }} Class: {{ race.race_class }}</li>
                            </ul>
                        </div>

                        <!-- Runner Details Table -->
                        <table>
                            <thead>
                                <tr>
                                    <th>Horse Number</th>
                                    <th>Horse</th>
                                    <th>Age</th>
                                    <th>Weight</th>
                                    <th>Jockey</th>
                                    <th>Trainer</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for runner in race.runners %}
                                    <tr>
                                        <td>{{ runner.number }}</td>
                                        <td>{{ runner.horse }}</td>
                                        <td>{{ runner.age }}</td>
                                        <td>{{ runner.lbs }}</td>
                                        <td>{{ runner.jockey }}</td>
                                        <td>{{ runner.trainer }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endfor %}
</div>
{% endblock %}

